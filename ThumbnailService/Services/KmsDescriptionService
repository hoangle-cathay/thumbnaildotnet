using Google.Cloud.Kms.V1;
using Google.Protobuf;
using System;

public class KmsDecryptionService
{
    private readonly KeyManagementServiceClient _kmsClient;
    private readonly string _kmsKeyName;

    public KmsDecryptionService(string kmsKeyName)
    {
        _kmsClient = KeyManagementServiceClient.Create();
        _kmsKeyName = kmsKeyName;
    }

    public string DecryptFromBase64(string base64Ciphertext)
    {
        var ciphertextBytes = Convert.FromBase64String(base64Ciphertext);

        var request = new DecryptRequest
        {
            Name = _kmsKeyName,
            Ciphertext = ByteString.CopyFrom(ciphertextBytes)
        };

        var response = _kmsClient.Decrypt(request);
        return response.Plaintext.ToStringUtf8();
    }
}
